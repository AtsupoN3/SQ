<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>サラリーマン・クエスト</title>
<style>
  body { font-family: 'Arial', sans-serif; background:#f0f0f0; margin:0; padding:0; }
  header { background:#333; color:#fff; padding:10px; text-align:center; }
  main { padding:20px; max-width: 500px; margin: auto; background:#fff; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
  button { padding: 10px 15px; margin: 5px 0; font-size: 1rem; width: 100%; cursor: pointer; background:#007bff; color:white; border:none; border-radius:5px; }
  button:hover { background:#0056b3; }
  button:disabled { background:#ccc; cursor:not-allowed; }
  .status { background:#eee; padding:12px; margin-bottom: 15px; border-radius: 5px; font-size:0.9rem; line-height:1.6; }
  .status-danger { color: #d32f2f; font-weight: bold; }
  .status-warning { color: #f39c12; font-weight: bold; }
  .status-good { color: #2ecc71; font-weight: bold; }
  .log { background:#222; color:#0f0; padding:10px; height: 140px; overflow-y: auto; font-family: monospace; font-size: 0.75rem; border-radius: 5px; white-space: pre-wrap; word-wrap:break-word; }
  .ending { font-size: 1.3rem; font-weight: bold; padding: 30px 20px; border-radius: 10px; text-align: center; line-height:1.8; color: white; background-color: #d32f2f; }
  .ending-ceo { background-color: #d32f2f !important; }
  .ending-fired { background-color: #c62828 !important; }
  .ending-manager { background-color: #e53935 !important; }
  .ending-dream { background-color: #e64a19 !important; }
  .ending-quiet { background-color: #d32f2f !important; }
  #event-text { background:#f9f9f9; padding:15px; border-radius:5px; margin-bottom:15px; min-height:60px; color: black; }
  #choices { display:flex; flex-direction:column; gap:5px; }
</style>
</head>
<body>
<header><h1>サラリーマン・クエスト</h1></header>
<main>
  <div class="status">
    <p><strong>体力:</strong> <span id="hp" class="status-good">100</span> | <strong>ストレス:</strong> <span id="stress" class="status-good">0</span> | <strong>スキル:</strong> <span id="skill" class="status-good">1.0</span></p>
    <p><strong>経験値:</strong> <span id="xp">0</span> | <strong>昇進:</strong> <span id="promotion">0</span></p>
    <p><strong>部署:</strong> <span id="department">未配属</span> | <strong>ターン:</strong> <span id="turns">0</span></p>
  </div>

  <div id="event-text">新入社員として入社しました。所属する部署を選んでください。</div>

  <div id="choices"></div>

  <div class="log" id="log"></div>
</main>

<script>
let hp = 100;
let stress = 0;
let skill = 1;
let xp = 0;
let promotion = 0;
let department = '未配属';
let items = [];
let turns = 0;

function logMessage(message) {
  const log = document.getElementById('log');
  log.textContent += message + '\n';
  log.scrollTop = log.scrollHeight;
}

function getStatusClass(hpVal, stressVal) {
  if(hpVal <= 20 || stressVal >= 80) {
    return 'status-danger';
  } else if(hpVal <= 40 || stressVal >= 60) {
    return 'status-warning';
  } else {
    return 'status-good';
  }
}

function updateStatus() {
  const hpVal = Math.round(hp);
  const stressVal = Math.round(stress);
  const skillVal = (Math.round(skill * 10) / 10).toFixed(1);
  
  const hpSpan = document.getElementById('hp');
  const stressSpan = document.getElementById('stress');
  const skillSpan = document.getElementById('skill');
  
  hpSpan.textContent = hpVal;
  stressSpan.textContent = stressVal;
  skillSpan.textContent = skillVal;
  
  const statusClass = getStatusClass(hpVal, stressVal);
  hpSpan.className = statusClass;
  stressSpan.className = statusClass;
  skillSpan.className = 'status-good';
  
  document.getElementById('xp').textContent = xp;
  document.getElementById('promotion').textContent = promotion;
  document.getElementById('department').textContent = department;
  document.getElementById('turns').textContent = turns;
}

function clearChoices() {
  document.getElementById('choices').innerHTML = '';
}

function startGame() {
  hp = 100;
  stress = 0;
  skill = 1;
  xp = 0;
  promotion = 0;
  department = '未配属';
  items = [];
  turns = 0;
  updateStatus();
  document.getElementById('log').textContent = '';
  logMessage('--- ゲーム開始 ---');
  showDepartmentSelection();
}

function showDepartmentSelection() {
  const eventText = document.getElementById('event-text');
  eventText.textContent = '新入社員として入社しました。所属する部署を選んでください。';
  eventText.style.backgroundColor = '#f9f9f9';
  eventText.style.color = 'black';
  clearChoices();

  ['営業部', '企画部', '開発部', '総務部'].forEach(dep => {
    const btn = document.createElement('button');
    btn.textContent = dep;
    btn.onclick = () => {
      department = dep;
      logMessage(`→ ${dep} に配属される`);
      updateStatus();
      clearChoices();
      normalWorkEvent();
    };
    document.getElementById('choices').appendChild(btn);
  });
}

function checkPromotion() {
  const prev = promotion;
  const eventText = document.getElementById('event-text');
  
  if(xp >= 450 && promotion < 3) {
    promotion = 3;
    skill += 3;
    hp = Math.min(100, hp + 25);
    stress = Math.max(0, stress - 30);
    eventText.textContent = "おめでとうございます！部長に昇進する！スキル大幅アップ、体力とストレスボーナス！";
    eventText.style.backgroundColor = '#90EE90';
    logMessage("おめでとうございます！部長に昇進する！スキル大幅アップ、体力とストレスボーナス！");
  } else if(xp >= 300 && promotion < 2) {
    promotion = 2;
    skill += 2;
    hp = Math.min(100, hp + 20);
    stress = Math.max(0, stress - 20);
    eventText.textContent = "おめでとうございます！課長に昇進する！スキルアップ、体力＆ストレス改善！";
    eventText.style.backgroundColor = '#90EE90';
    logMessage("おめでとうございます！課長に昇進する！スキルアップ、体力＆ストレス改善！");
  } else if(xp >= 150 && promotion < 1) {
    promotion = 1;
    skill += 1;
    hp = Math.min(100, hp + 15);
    stress = Math.max(0, stress - 10);
    eventText.textContent = "おめでとうございます！主任に昇進する！スキル上昇、体力・ストレス改善！";
    eventText.style.backgroundColor = '#90EE90';
    logMessage("おめでとうございます！主任に昇進する！スキル上昇、体力・ストレス改善！");
  }
  
  if(promotion !== prev) {
    updateStatus();
  }
}

function showEnding(type, message) {
  const eventText = document.getElementById('event-text');
  eventText.className = "ending " + type;
  eventText.style.backgroundColor = '#d32f2f';
  eventText.style.color = 'white';
  eventText.textContent = message;
  clearChoices();

  const btn = document.createElement('button');
  btn.textContent = 'もう一度プレイする';
  btn.onclick = () => {
    eventText.className = "";
    eventText.style.backgroundColor = '#f9f9f9';
    eventText.style.color = 'black';
    startGame();
  };
  document.getElementById('choices').appendChild(btn);
}

function checkEnding() {
  if(turns < 10) return false;

  logMessage(`[Ck] T${turns} HP${Math.round(hp)} ST${Math.round(stress)} XP${xp} SK${(Math.round(skill*10)/10).toFixed(1)} Pr${promotion}`);

  if(turns >= 50) {
    if(hp <= 10 || stress >= 110) {
      showEnding('ending-fired', '【クビのエンド】\n過労で会社を去ることになる...');
      logMessage('★ ゲームクリア: クビエンド（50T強制）');
      return true;
    }
    if(xp >= 600 && skill >= 5.5) {
      showEnding('ending-ceo', '【社長エンド】\nあなたは社長となり、大成功を収める！');
      logMessage('★ ゲームクリア: 社長エンド（50T強制）');
      return true;
    }
    if(promotion >= 2) {
      showEnding('ending-manager', '【安定管理職エンド】\n中間管理職として安定した人生を送る。');
      logMessage('★ ゲームクリア: 管理職エンド（50T強制）');
      return true;
    }
    if(xp < 200 && skill >= 3) {
      showEnding('ending-dream', '【夢追い人エンド】\n新しい挑戦を続けている。');
      logMessage('★ ゲームクリア: 夢追い人エンド（50T強制）');
      return true;
    }
    if(stress >= 70) {
      showEnding('ending-quiet', '【静かな暮らしエンド】\n現状に疲れて、静かに過ごす決断をする。');
      logMessage('★ ゲームクリア: 静かエンド（50T強制）');
      return true;
    }
    showEnding('ending-manager', '【安定管理職エンド】\n中間管理職として安定した人生を送る。');
    logMessage('★ ゲームクリア: 管理職エンド（50Tデフォルト）');
    return true;
  }

  if(stress >= 110 || hp <= 5) {
    showEnding('ending-fired', '【クビのエンド】\n過労で会社を去ることになる...');
    logMessage('★ ゲームクリア: クビエンド');
    return true;
  }

  if(xp >= 600 && skill >= 5.5 && promotion >= 3) {
    showEnding('ending-ceo', '【社長エンド】\nあなたは社長となり、大成功を収める！');
    logMessage('★ ゲームクリア: 社長エンド');
    return true;
  }

  if(xp < 200 && skill >= 3 && stress < 50 && hp > 40 && turns >= 12) {
    showEnding('ending-dream', '【夢追い人エンド】\n若くて夢多きあなたは新しい挑戦を続ける。');
    logMessage('★ ゲームクリア: 夢追い人エンド');
    return true;
  }

  if(promotion === 0 && stress >= 70 && stress < 110 && hp > 35 && turns >= 12) {
    showEnding('ending-quiet', '【静かな暮らしエンド】\n現状に疲れて、静かに過ごす決断をする。');
    logMessage('★ ゲームクリア: 静かエンド');
    return true;
  }

  if(promotion >= 1 && promotion <= 2 && stress < 70 && hp > 35 && xp >= 200 && xp < 600 && turns >= 12) {
    showEnding('ending-manager', '【安定管理職エンド】\n中間管理職として安定した人生を送る。');
    logMessage('★ ゲームクリア: 管理職エンド');
    return true;
  }

  return false;
}

function showNextButton() {
  clearChoices();
  const btn = document.createElement('button');
  btn.textContent = '次へ';
  btn.onclick = () => {
    btn.disabled = true;
    nextEvent();
  };
  document.getElementById('choices').appendChild(btn);
}

function nextEvent() {
  turns++;
  updateStatus();
  if(checkEnding()) return;
  checkPromotion();

  if(Math.random() < 0.4) {
    switch(department) {
      case '営業部': salesEvent(); break;
      case '企画部': planningEvent(); break;
      case '開発部': developmentEvent(); break;
      case '総務部': generalEvent(); break;
      default: normalWorkEvent();
    }
  } else {
    const r = Math.random();
    if(r < 0.25) negotiationEvent();
    else if(r < 0.5) presentationEvent();
    else if(r < 0.75) privateLifeEvent();
    else normalWorkEvent();
  }
}

function salesEvent() {
  const eventText = document.getElementById('event-text');
  eventText.style.backgroundColor = '#f9f9f9';
  eventText.style.color = 'black';
  eventText.textContent = '営業業務に取り組む。どうする？';
  clearChoices();

  const choices = [
    {t:'積極的に営業する', xp:90, sk:0.55, st:22, hp:-6, r:0.8},
    {t:'地道に営業する', xp:60, sk:0.25, st:12, hp:-2, r:0.95}
  ];

  choices.forEach(c => {
    const btn = document.createElement('button');
    btn.textContent = c.t;
    btn.onclick = () => {
      if(Math.random() < c.r) {
        xp += c.xp;
        skill += c.sk;
        stress += c.st;
        hp += c.hp;
        eventText.textContent = `成功！ XP+${c.xp} スキル+${c.sk}`;
        logMessage(`[営業] 成功 XP+${c.xp} SK+${c.sk}`);
      } else {
        stress += c.st + 10;
        eventText.textContent = `失敗。 ストレス+${c.st + 10}`;
        logMessage(`[営業] 失敗 ST+${c.st + 10}`);
      }
      updateStatus();
      showNextButton();
    };
    document.getElementById('choices').appendChild(btn);
  });
}

function planningEvent() {
  const eventText = document.getElementById('event-text');
  eventText.style.backgroundColor = '#f9f9f9';
  eventText.style.color = 'black';
  eventText.textContent = '企画案を作成中。どう進める？';
  clearChoices();

  const choices = [
    {t:'大胆に提案する', xp:70, sk:2.0, st:20, hp:-4, r:0.75},
    {t:'慎重に提案する', xp:50, sk:1.0, st:12, hp:-3, r:0.85}
  ];

  choices.forEach(c => {
    const btn = document.createElement('button');
    btn.textContent = c.t;
    btn.onclick = () => {
      if(Math.random() < c.r) {
        xp += c.xp;
        skill += c.sk;
        stress += c.st;
        hp += c.hp;
        eventText.textContent = `成功！ XP+${c.xp} スキル+${c.sk}`;
        logMessage(`[企画] 成功 XP+${c.xp} SK+${c.sk}`);
      } else {
        stress += c.st + 15;
        eventText.textContent = `失敗。 ストレス+${c.st + 15}`;
        logMessage(`[企画] 失敗 ST+${c.st + 15}`);
      }
      updateStatus();
      showNextButton();
    };
    document.getElementById('choices').appendChild(btn);
  });
}

function developmentEvent() {
  const eventText = document.getElementById('event-text');
  eventText.style.backgroundColor = '#f9f9f9';
  eventText.style.color = 'black';
  eventText.textContent = '開発プロジェクトに参加。どう取り組む？';
  clearChoices();

  const choices = [
    {t:'全力投球する', xp:80, sk:2.5, st:28, hp:-8, r:0.7},
    {t:'効率重視する', xp:60, sk:1.3, st:15, hp:-5, r:0.85}
  ];

  choices.forEach(c => {
    const btn = document.createElement('button');
    btn.textContent = c.t;
    btn.onclick = () => {
      if(Math.random() < c.r) {
        xp += c.xp;
        skill += c.sk;
        stress += c.st;
        hp += c.hp;
        eventText.textContent = `成功！ XP+${c.xp} スキル+${c.sk}`;
        logMessage(`[開発] 成功 XP+${c.xp} SK+${c.sk}`);
      } else {
        stress += c.st + 18;
        eventText.textContent = `失敗。 ストレス+${c.st + 18}`;
        logMessage(`[開発] 失敗 ST+${c.st + 18}`);
      }
      updateStatus();
      showNextButton();
    };
    document.getElementById('choices').appendChild(btn);
  });
}

function generalEvent() {
  const eventText = document.getElementById('event-text');
  eventText.style.backgroundColor = '#f9f9f9';
  eventText.style.color = 'black';
  eventText.textContent = '総務の仕事。どのように進める？';
  clearChoices();

  const choices = [
    {t:'丁寧に対応する', xp:40, sk:0.5, st:10, hp:-2, r:0.9},
    {t:'素早く対応する', xp:30, sk:0.3, st:5, hp:-1, r:0.95}
  ];

  choices.forEach(c => {
    const btn = document.createElement('button');
    btn.textContent = c.t;
    btn.onclick = () => {
      if(Math.random() < c.r) {
        xp += c.xp;
        skill += c.sk;
        stress += c.st;
        hp += c.hp;
        eventText.textContent = `成功！ XP+${c.xp}`;
        logMessage(`[総務] 成功 XP+${c.xp}`);
      } else {
        stress += c.st + 8;
        eventText.textContent = `失敗。 ストレス+${c.st + 8}`;
        logMessage(`[総務] 失敗 ST+${c.st + 8}`);
      }
      updateStatus();
      showNextButton();
    };
    document.getElementById('choices').appendChild(btn);
  });
}

function negotiationEvent() {
  const eventText = document.getElementById('event-text');
  eventText.style.backgroundColor = '#f9f9f9';
  eventText.style.color = 'black';
  eventText.textContent = '交渉の場面だ。どう攻める？';
  clearChoices();

  const choices = [
    {t:'強気で堂々と攻める', xp:55, sk:1.2, st:-18, r:0.7},
    {t:'柔軟に対応する', xp:40, sk:0.8, st:-10, r:0.85}
  ];

  choices.forEach(c => {
    const btn = document.createElement('button');
    btn.textContent = c.t;
    btn.onclick = () => {
      if(Math.random() < c.r) {
        xp += c.xp;
        skill += c.sk;
        stress = Math.max(0, stress + c.st);
        eventText.textContent = `交渉成功！ XP+${c.xp}`;
        logMessage(`[交渉] 成功 XP+${c.xp}`);
      } else {
        stress += 30;
        eventText.textContent = `失敗。 ストレス+30`;
        logMessage(`[交渉] 失敗 ST+30`);
      }
      updateStatus();
      showNextButton();
    };
    document.getElementById('choices').appendChild(btn);
  });
}

function presentationEvent() {
  const eventText = document.getElementById('event-text');
  eventText.style.backgroundColor = '#f9f9f9';
  eventText.style.color = 'black';
  eventText.textContent = 'プレゼンの時間。どう話す？';
  clearChoices();

  const choices = [
    {t:'詳細に説明する', xp:50, sk:1.3, st:-12, r:0.75},
    {t:'簡潔に説明する', xp:45, sk:1.0, st:-10, r:0.9}
  ];

  choices.forEach(c => {
    const btn = document.createElement('button');
    btn.textContent = c.t;
    btn.onclick = () => {
      if(Math.random() < c.r) {
        xp += c.xp;
        skill += c.sk;
        stress = Math.max(0, stress + c.st);
        eventText.textContent = `発表成功！ XP+${c.xp}`;
        logMessage(`[プレゼン] 成功 XP+${c.xp}`);
      } else {
        stress += 25;
        eventText.textContent = `失敗。 ストレス+25`;
        logMessage(`[プレゼン] 失敗 ST+25`);
      }
      updateStatus();
      showNextButton();
    };
    document.getElementById('choices').appendChild(btn);
  });
}

function privateLifeEvent() {
  const eventText = document.getElementById('event-text');
  eventText.style.backgroundColor = '#f9f9f9';
  eventText.style.color = 'black';
  eventText.textContent = 'プライベートタイム。どう過ごす？';
  clearChoices();

  const choices = [
    {t:'ドローン飛行を楽しむ', st:-40, hp:15},
    {t:'友人と飲み会に行く', st:-25, hp:-8},
    {t:'家で休む', st:-35, hp:18}
  ];

  choices.forEach(c => {
    const btn = document.createElement('button');
    btn.textContent = c.t;
    btn.onclick = () => {
      stress = Math.max(0, stress + c.st);
      hp = Math.min(100, Math.max(0, hp + c.hp));
      eventText.textContent = `${c.t}。`;
      logMessage(`[プライベート] ST${c.st} HP${c.hp > 0 ? '+' : ''}${c.hp}`);
      updateStatus();
      showNextButton();
    };
    document.getElementById('choices').appendChild(btn);
  });
}

function normalWorkEvent() {
  const eventText = document.getElementById('event-text');
  eventText.style.backgroundColor = '#f9f9f9';
  eventText.style.color = 'black';
  eventText.textContent = '通常業務。どう過ごす？';
  clearChoices();

  const choices = [
    {
      t:'仕事を頑張る',
      f: () => {
        xp += 30;
        skill += 0.6;
        stress += 20;
        hp -= 5;
        logMessage(`[仕事] XP+30 SK+0.6`);
      }
    },
    {
      t:'休憩を取る',
      f: () => {
        stress = Math.max(0, stress - 30);
        hp = Math.min(100, hp + 15);
        logMessage(`[休憩] ST-30 HP+15`);
      }
    },
    {
      t:'スキル勉強をする',
      f: () => {
        if(Math.random() < 0.85) {
          skill += 1.8;
          xp += 50;
          hp -= 10;
          stress += 10;
          logMessage(`[勉強] 成功 SK+1.8 XP+50`);
        } else {
          stress += 20;
          logMessage(`[勉強] 失敗 ST+20`);
        }
      }
    }
  ];

  choices.forEach(c => {
    const btn = document.createElement('button');
    btn.textContent = c.t;
    btn.onclick = () => {
      c.f();
      eventText.textContent = `${c.t}。`;
      updateStatus();
      showNextButton();
    };
    document.getElementById('choices').appendChild(btn);
  });
}

window.onload = () => {
  startGame();
};
</script>
</body>
</html>
